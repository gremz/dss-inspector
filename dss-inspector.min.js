(function e(){function a(){var e=window&&window.opener&&window.opener.trb&&window.opener.trb.meteringService;if(!e){t(".dss_inspector_activity").addClass("alert busy");f(2e3);return}e.getStatus(function(e){var n=JSON.stringify(e,null,"	");n=n.replace(/urlPattern\"\:(\s\".+\")/gi,'urlPattern": <span class="dss_url_pattern_container hidden"><span class="dss_url_pattern_visibility"></span><span class="dss_inspector_url_pattern" >$1</span></span>');n=n.replace(/\"(.+\"\:)/gi,'<span class="dss_inspector_title">$1').replace(/\"(\:)/gi,":</span>");c(n);t(".refresh_time").html("Last Successful update: "+(new Date).toString());t(".dss_url_pattern_visibility").click(function(e){t(this).parent().toggleClass("hidden")});t(".dss_inspector_activity").removeClass("alert busy")});e.storage.lock(e.lockedKey,e.lockedDateKey,(~~(Math.random()*1e8)).toString(),function(){e.getStoredPages(function(n){t(".dss_show_meter").text(n);e.storage.unlock(e.lockedKey,e.lockedDateKey)})});f(4e3)}function f(e,t){if(!e){return}setTimeout(function(){a()},e)}function l(e,t){n.append('<div class="alert '+(t?t:"")+'">'+e+"</div>")}function c(e){t(".status").html(e)}if(!document.body||!document.head){setTimeout(function(){e()},200);return}var t=window.jQuery,n=t("body"),r=".alert {"+"margin-bottom: 5px; "+"padding: 8px 35px 8px 14px;"+"text-shadow: 0 1px 0 rgba(255, 255, 255, 0.5);"+"border: 1px solid #fbeed5;"+"border-radius: 4px;"+"background-color: #fcf8e3;"+"color: #c09853;"+"}"+".error {"+"background-color: #f2dede;"+"border-color: #eed3d7;"+"color: #b94a48;"+"}"+".success {"+"background-color: #dff0d8;"+"border-color: #d6e9c6;"+"color: #468847;"+"}"+".status {"+"white-space: pre-wrap;"+"}"+".busy:after {"+'content: "Wating for metering (or it doesn\'t exist)...";'+"}"+".dss_url_pattern_container.hidden .dss_inspector_url_pattern, .dss_edit_container {"+"display: none;"+"}"+".dss_url_pattern_container.hidden .dss_url_pattern_visibility:after {"+'content: "[Show]";'+"}"+".dss_url_pattern_container .dss_url_pattern_visibility {"+"color: #3a87ad;"+"}"+".dss_url_pattern_container .dss_url_pattern_visibility:after {"+'content: "[Hide]";'+"}"+".dss_inspector_title {"+"color: #468847;"+"}"+".refresh_time {"+"display: block;"+"}"+".dss_edit_container, .dss_show_container {"+"width: 96%;"+"margin-bottom: 10px;"+"}"+"textarea, .dss_show_meter {"+"display: block;"+"width: 100%;"+"height: 68px;"+"padding: 6px 12px;"+"font-size: 14px;"+"line-height: 1.428571429;"+"color: #555;"+"background-color: #fff;"+"border: 1px solid #ccc;"+"border-radius: 4px;"+"-webkit-box-shadow: inset 0 1px 1px rgba(0,0,0,.075);"+"box-shadow: inset 0 1px 1px rgba(0,0,0,.075);"+"-webkit-transition: border-color ease-in-out .15s,box-shadow ease-in-out .15s;"+"transition: border-color ease-in-out .15s,box-shadow ease-in-out .15s;"+"}",i='<h4>Metering Status</h4><pre class="status"></pre>'+'<div class="dss_inspector_activity"></div>'+"<h4>Metered pages:</h4>"+'<div class="dss_show_container">'+'<span data-dss-inspector="editMeterPages" class="dss_show_meter"></span>'+'<input type="button" data-dss-inspector="editMeterPages" value="Edit">'+"</div>"+'<div class="dss_edit_container">'+'<textarea class="dss_edit_pages"></textarea>'+'<input type="button" data-dss-inspector="updateAndEditPages" value="Update">'+'<input type="button" data-dss-inspector="hideEditPages" value="Go Back">'+"</div>"+'<span class="refresh_time"></span>'+"<h4>Quick Tools</h4>"+'<button data-dss-inspector="createUser">Generate new SSOR user</button>'+'<button data-dss-inspector="killMeterModal">Kill modals</button>'+'<div class="dss_generate_view"></div>';t("head").append("<style>"+r+"</style>");n.append(i);t(document).click(function(e){var n=t(e.target);n.attr("data-dss-inspector")&&u[n.attr("data-dss-inspector")](e)});var s=window&&window.opener&&window.opener.trb&&window.opener.trb.meteringService,o=window&&window.opener&&window.opener.registration,u={createUser:function(e){if(o){o.utils.webMessage.tokenRetriever({successCallback:function(e){var n=e.validationToken,r=(~~(Math.random()*1e5)).toString(),i={masterId:"",email:"ssortestuser"+r+"@trb.com",password:"abc1234",zipcode:r,tos:"true",username:"ssortestuser"+r};o.utils.webMessage.createNewAccount(n,i,{successCallback:function(e){i.masterId=e.masterId;o.utils.webMessage.submitConsumerProfile(e.successToken,i,{successCallback:function(e){var n=e.profileResponse;t(".dss_generate_view").append("<p>masterId: "+n.consumerId+", username: "+n.email+", password: "+"abc1234</p>");l("Consumer created!")},errorCallback:function(){l("Failed to create consumer!")}})},errorCallback:function(){l("Failed to create consumer!")}})},errorCallback:function(){l("Failed to create consumer!")}})}},editMeterPages:function(e){var n=t(".dss_edit_pages");t(".dss_show_container").toggle();t(".dss_edit_container").toggle();n.val(t(".dss_show_meter").text());t("").bind("click",function(){s.storage.setItem(s.storedPagesKey,s.util.stringify(n.val().split(",")))})},updateAndEditPages:function(e){var n=t(".dss_edit_pages");s.storage.setItem(s.storedPagesKey,s.util.stringify(n.val().split(",")));t(".dss_show_container").toggle();t(".dss_edit_container").toggle()},hideEditPages:function(e){t(".dss_show_container").toggle();t(".dss_edit_container").toggle()},killMeterModal:function(e){s.meterData&&s.meterData[0].modals&&s.meterData[0].modals[0].destroy();s.meterData[0].modals=undefined;s.meterData[0].cancelStop();s.dead=true;o.manager.closeCurrentDialog()}};a()})()